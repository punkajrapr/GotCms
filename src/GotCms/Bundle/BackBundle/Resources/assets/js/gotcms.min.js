var Translator=(function(a){return{data:new Hash(),initialize:function(b){this.data=new Hash(b);return this},translate:function(b){if(this.data.get(b)){return this.data.get(b)}return b},add:function(b,c){this.data.set(b,c);return this}}})(jQuery);function Hash(a){this.nh=(a===undefined)?{}:a;this.each=function(c){for(var b in this.nh){if(typeof(this.nh[b])!=="function"){c({key:b,value:this.nh[b]})}}};this.get=function(b){for(var c in this.nh){if(c===b){return this.nh[b]}}};this.set=function(c,b){this.nh[c]=b;return this.nh}}function Template(a){this.body=a;this.evaluate=function(c){var b=this.body;$.each(c,function(e,f){var g,d="(#|&#x23;)(\\{|&#x7B;)"+e+"(\\}|&#x7D;)";g=new RegExp(d,"gi");b=b.replace(g,f)});return b}}if(typeof $.ui!=="undefined"){$.widget("ui.dialog",$.extend({},$.ui.dialog.prototype,{_title:function(a){if(!this.options.title){a.html("&#160;")}else{a.html(this.options.title)}}}))}var Gc=(function(a){var c=a(document),b=a(window);c.ready(function(){Gc.initialize();Gc.initializeMenu();Gc.notification()});return{initialize:function(){this._options=new Hash()},initializeMenu:function(){var e=600,d=a("#menu-toggler");a(document).on("click",".menu-toggle",function(){var f=a(this).parent();if(!f.hasClass("open")){a(this).next(".submenu").stop(true,true).fadeIn({duration:e,queue:false}).slideDown(e,function(){a(this).parent().toggleClass("open")})}else{a(this).next(".submenu").stop(true,true).fadeOut({duration:e,queue:false}).slideUp(e,function(){a(this).parent().toggleClass("open")})}});a(window).on("scroll",function(){var f=a(".btn-scroll-up");if(a(window).scrollTop()!==0&&f.is(":not(:visible)")){f.fadeIn()}else{if(a(window).scrollTop()===0){f.fadeOut()}}});d.on("click",function(){a("#sidebar").toggleClass("show")});a(".btn-scroll-up").on("click",function(){a("html,body").animate({scrollTop:0},"slow");return false})},setOption:function(e,d){this._options.set(e,d)},getOption:function(d){return this._options.get(d)},setHtmlMessage:function(e,f){var d=new Template('<div class="notification #{type}"><a href="#" class="close"><img src="/backend/images/close-small.png" title="Close this notification" alt="Close"></a><div>#{message}</div></div>');a(".html-message").html(d.evaluate({message:e,type:f}))},isEmpty:function(d){if(d===undefined){return true}if(typeof d==="object"){return a.isEmptyObject(d)}else{return a.trim(d)===""}},initDocumentType:function(h,i,g,e,f){var j=this,k;a(".tabs").tabs();a("#tabs").sortable({placeholder:"ui-state-highlight",distance:10,start:function(l,m){k=m.item.index();a(this).find(".ui-state-highlight").height(m.item.height()-4)},stop:function(o,p){var n=a("#properties-tabs-content > .ui-tabs-nav").find(".row"),m=p.item.index(),l=n.eq(k).detach();if(m===n.length){n.eq(m-1).after(l)}else{n.eq(m).before(l)}}});a("#tabs-add").on("click",function(){var m,l;m=a("#tabs-addname");l=a("#tabs-adddescription");if(j.isEmpty(m.val())||j.isEmpty(l.val())){j.setHtmlMessage(Translator.translate("Please fill all fields"),"error")}else{a.post(h,{name:m.val(),description:l.val()},function(p){if(p.message!==undefined){j.setHtmlMessage(p.message,"error")}else{var n,o,q;n=a("#tabs");o=a('<li class="list-item">     <div class="list-handle">         <i class="glyphicon glyphicon-move"></i>         <div class="col-lg-10">             <div class="col-lg-6">                 <input type="text" class="form-control"                 name="tabs[tab'+p.id+'][name]" value="'+m.val()+'">             </div>             <div class="col-lg-6">                 <input type="text" class="form-control"                 name="tabs[tab'+p.id+'][description]" value="'+l.val()+'">             </div>         </div>         <div class="col-lg-1">             <button type="button" value="'+p.id+'" class="delete-tab btn btn-danger">                 <i class="glyphicon glyphicon-remove"></i> '+Translator.translate("Delete")+"            </button>         </div>     </div> </li>");n.append(o);a(".select-tab").append(new Option(m.val(),p.id));if(a("#properties-tabs-content").html()!==null){q=a("#properties-tabs-content");q.append('<div id="tabs-properties-'+p.id+'"></div>');q.children("ul").append('<li>                                     <a href="#tabs-properties-'+p.id+'"> '+m.val()+"</a></li>");q.tabs("refresh");a("#tabs-properties-"+p.id).append('<div class="sortable connected-sortable ui-helper-reset">')}}})}});a(document).on("click",".delete-tab",function(){var l=a(this);a.post(g,{tab:l.val()},function(o){a(".select-tab").find('option[value="'+l.val()+'"]').remove();var n=a("#properties-tabs-content");l.closest(".list-item").remove();var p=n.find('a[href="#tabs-properties-'+l.val()+'"]').parent();var m=a("li",n).index(p);n.find(".ui-tabs-nav li:eq("+m+")").remove();a("#tabs-properties-"+l.val()).remove();n.tabs("refresh");j.setHtmlMessage(o.message,"success")})});a("#display-property").on("click",function(){a(this).next().toggleClass("hide");a(this).find(".glyphicon").toggleClass("glyphicon-minus");a(this).find(".glyphicon").toggleClass("glyphicon-plus")});var d=a("#properties-tabs-content").tabs({idPrefix:"tabs-properties",panelTemplate:"<div></div>"});j.setOption("accordion-option",{header:"div > h3",collapsible:true,autoHeight:false,active:-1});j.refreshProperties(d);a("#property-add").on("click",function(){var q=a("#properties-name"),m=a("#properties-identifier"),p=a("#properties-tab"),n=a("#properties-datatype"),l=a("#properties-description"),o=a("#properties-required");if(j.isEmpty(m.val())||j.isEmpty(q.val())||j.isEmpty(p.val())||j.isEmpty(n.val())){j.setHtmlMessage(Translator.translate("Please fill all fields"),"error")}else{a.post(i,{name:q.val(),identifier:m.val(),tab:p.val(),datatype:n.val(),description:l.val(),isRequired:o.val()},function(r){if(r.success===false){j.setHtmlMessage(r.message,"error")}else{var s=new Template('<div><h3><a href="#secion#{id}">#{name} (#{identifier})</a></h3> <div class="form-horizontal">     <div class="form-group">         <label class="required control-label col-lg-2" for="properties-name-#{tab}-#{id}">         '+Translator.translate("Name")+'</label>         <div class="col-lg-10">             <input type="text" class="form-control" value="#{name}" id="properties-name-#{tab}-#{id}"             name="properties[property#{id}][name]">         </div>     </div>     <div class="form-group">         <label class="required control-label col-lg-2" for="properties-identifier-#{tab}-#{id}">         '+Translator.translate("Identifier")+'</label>         <div class="col-lg-10">             <input type="text" class="form-control" value="#{identifier}" id="properties-identifier-#{tab}-#{id}"             name="properties[property#{id}][identifier]">         </div>     </div>     <div class="form-group">         <label class="required control-label col-lg-2" for="properties-datatype-#{tab}-#{id}">         '+Translator.translate("Datatype")+'</label>         <div class="col-lg-10">             <select class="form-control select-datatype" id="properties-datatype-#{tab}-#{id}"             name="properties[property#{id}][datatype]">             </select>         </div>     </div>     <div class="form-group">         <label class="required control-label col-lg-2" for="properties-description-#{tab}-#{id}">         '+Translator.translate("Description")+'</label>         <div class="col-lg-10">             <input type="text" class="form-control" value="#{description}" id="properties-description-#{tab}-#{id}"             name="properties[property#{id}][description]">         </div>     </div>     <div class="form-group">         <label class="required control-label col-lg-2" for="properties-required-#{tab}-#{id}">         '+Translator.translate("Required")+'</label>         <div class="col-lg-10">             <div class="input-checkbox">                 <input type="checkbox" name="properties[property#{id}][required]" class="input-checkbox"             id="properties-required-#{tab}-#{id}" value="1">                 <label for="properties-required-#{tab}-#{id}"></label>             </div>         </div>     </div>     <div class="clearfix">         <input class="property-tab-id" type="hidden" id="properties-tab-#{id}"             name="properties[property#{id}][tab]" value="#{tab}">         <button type="button" value="#{id}" class="delete-property btn btn-danger">             <i class="glyphicon glyphicon-remove"></i> '+Translator.translate("Delete")+"         </button>     </div> </div></div>");s=a(s.evaluate(r));a("#tabs-properties-"+p.val()).children("div:first").append(s);a(".connected-sortable").accordion(Gc.getOption("accordion-option"));a("#properties-tab-"+r.tab+"-"+r.id).html(a("#properties-tab").html()).val(r.tab);a("#properties-datatype-"+r.tab+"-"+r.id).html(a("#properties-datatype").html()).val(r.datatype);a("#properties-required-"+r.tab+"-"+r.id).prop("checked",o.prop("checked"));j.refreshProperties(d)}})}});a(document).on("click",".delete-property",function(){var l=a(this);a.post(e,{property:l.val()},function(m){if(m.success===true){l.parent().parent().parent().remove();a(".connected-sortable").accordion(Gc.getOption("accordion-option"));j.setHtmlMessage(m.message,"success")}else{j.setHtmlMessage(m.message,"error")}})});a("#import-tab-button").on("click",function(){var l=a("#import-tabs").val();a.post(f,{tab_id:l},function(n){if(n.success===true){a.ajaxSetup({async:false});var p=n.tab,o=a("#tabs-addname"),m=a("#tabs-adddescription");o.val(p.name);m.val(p.description);a("#tabs-add").click();l=a(".select-tab").find("option:last").val();a.each(p.properties,function(t,u){var x=a("#properties-name"),r=a("#properties-identifier"),w=a("#properties-tab"),s=a("#properties-datatype"),q=a("#properties-description"),v=a("#properties-required");x.val(u.name);r.val(u.identifier);w.val(l);s.val(u.datatype);q.val(u.description);v.prop("checked",u.isRequired);a("#property-add").click();x.val("");r.val("");w.val("");s.val("");q.val("");v.prop("checked",false)});o.val("");m.val("");a.ajaxSetup({async:true})}});return false})},refreshProperties:function(d){if(a(".connected-sortable").hasClass("ui-accordion")){a(".connected-sortable").accordion("destroy")}a(".connected-sortable").accordion(this.getOption("accordion-option")).sortable({placeholder:"ui-state-highlight",handle:"h3",distance:10});var e=a("ul:first li",d).droppable({accept:".connected-sortable div",hoverClass:"ui-state-hover",tolerance:"pointer",drop:function(i,j){var g=a(this);var h=a(g.find("a").attr("href")).find(".connected-sortable");var f=g.find("a").attr("href").replace("#tabs-properties-","");j.draggable.hide("slow",function(){d.tabs("option","active",e.index(g));a(this).appendTo(h).show("slow");a(this).find(".property-tab-id").val(f);a(this).attr("style","");a(".connected-sortable").accordion("refresh")})},stop:function(f,g){g.item.children("h3").triggerHandler("focusout")}})},sortableMenu:function(d){a("#documents").find("ul").sortable({update:function(){a.ajax({url:d,type:"post",dataType:"json",data:{order:a(this).sortable("toArray").join()}})},distance:10})},initDocumentMenu:function(e,h){var g=this,d=a("#document_"+e).closest("li"),f;if(d.length>0){if(d.children("ul").length>0){f=d.prop("id")}else{f=d.parent().closest("li").prop("id")}}if(f===undefined){f="documents"}a("#browser").jstree({plugins:["themes","html_data"],core:{initially_open:[f]},themes:{theme:"default",url:"/backend/js/vendor/themes/default/style.css"}}).bind("refresh.jstree",function(){g.sortableMenu(h)}).bind("loaded.jstree",function(){g.sortableMenu(h);a.contextMenu({selector:"#browser a",build:function(i){var j={"new":{name:Translator.translate("New"),icon:"add"},edit:{name:Translator.translate("Edit"),icon:"edit"},"delete":{name:Translator.translate("Delete"),icon:"delete"},publish:{name:Translator.translate("Publish"),icon:"publish"},unpublish:{name:Translator.translate("Unpublish"),icon:"unpublish"},sep1:"---------",cut:{name:Translator.translate("Cut"),icon:"cut"},copy:{name:Translator.translate("Copy"),icon:"copy"},paste:{name:Translator.translate("Paste"),icon:"paste",disabled:(g.getOption("lastAction")==="paste"||g.getOption("lastAction")===undefined)},sep2:"---------",refresh:{name:Translator.translate("Refresh"),icon:"refresh"},quit:{name:Translator.translate("Quit"),icon:"quit"}};if(i.hasClass("not-published")){delete (j.unpublish)}else{delete (j.publish)}return{items:j}},callback:function(o,i){var k=a(this),l,m,n,j;if(o!=="refresh"&&o!=="new"&&o!=="paste"&&k.parent("li").attr("id")==="documents"){return true}l=g.getOption("routes");m=l[o];n=0;if(k.attr("id")!==undefined){n=k.attr("id")}m=m.replace("itemId",n);j=true;switch(o){case"refresh":g.refreshTreeview(m,n);return true;case"new":if(!g.isEmpty(n)){m+="/parent/"+n}break;case"edit":break;case"copy":j=false;case"cut":g.setOption("lastAction",o);case"paste":if(g.getOption("lastAction")==="copy"&&j===true){g.showCopyForm(m,o,i);return true}a.ajax({url:m,dataType:"json",data:{},success:function(p){if(p.success===true){if(o==="paste"&&g.getOption("lastAction")==="cut"){g.refreshTreeview(l.refresh.replace("itemId",0),0)}}}});return true;case"publish":case"unpublish":a.ajax({url:m,dataType:"json",data:{},success:function(p){if(p.success===true){if(o==="publish"){k.removeClass("not-published")}else{k.addClass("not-published")}}}});return true;case"delete":g.showDeleteDialog(m,k.parent());return true;case"quit":default:return true}document.location.href=m}})})},refreshTreeview:function(f,e){var d=a("#browser");a.ajax({url:f,data:{},success:function(g){if(e===0){a("#documents").children("ul").remove();a("#documents").append(g.treeview)}else{a("#"+e).next("ul").remove();a("#"+e).after(g.treeview)}d.jstree("refresh")}})},showDeleteDialog:function(f,d){var g="These items will be permanently deleted and cannot be recovered. Are you sure?",e='<div id="dialog" title="">                     <p>'+Translator.translate(g)+"</p>                 </div>";a(e).dialog({bgiframe:false,resizable:false,modal:true,title:'<div class="widget-header widget-header-small">                     <h4><i class="glyphicon glyphicon-warning-sign"></i>                     '+Translator.translate("Delete element")+"</h4></div>",overlay:{backgroundColor:"#000",opacity:0.5},buttons:[{text:Translator.translate("Cancel"),"class":"btn btn-warning",click:function(){a(this).dialog("close");return false}},{text:Translator.translate("Confirm"),"class":"btn btn-danger btn-mini",click:function(){a.get(f,function(h){if(h.success===true){d.remove()}});a(this).dialog("close");return true}}]})},showCopyForm:function(g,i,d){var h=this,f='<div id="copy-dialog-form" title="">                 <p class="validateTips">'+Translator.translate("All form fields are required.")+'</p>                 <fieldset>                     <div>                         <label for="name">'+Translator.translate("Name")+'</label>                         <input type="text" name="name" id="copy-name"                         class="form-control ui-widget-content ui-corner-all" />                     </div>                     <div>                         <label for="email">'+Translator.translate("Url key")+'</label>                         <input type="text" name="url-key" id="copy-url-key" value=""                         class="form-control ui-widget-content ui-corner-all" />                     </div>                </fieldset>             </div>';var e={};e[Translator.translate("Copy")]={text:Translator.translate("Copy"),"class":"btn btn-danger btn-mini",click:function(){var k=a("#copy-name"),j=a("#copy-url-key");if(h.isEmpty(k.val())||h.isEmpty(j.val())){return false}a.ajax({url:g,dataType:"json",data:{name:k.val(),url_key:j.val()},success:function(l){if(l.success===true){if(i==="paste"&&h.getOption("lastAction")==="cut"){d.items.paste.disabled=true}h.refreshTreeview(h.getOption("routes").refresh.replace("itemId",0),0)}}});a(this).dialog("close")}};e[Translator.translate("Cancel")]={text:Translator.translate("Cancel"),"class":"btn btn-warning",click:function(){a(this).dialog("close");return false}};a("#copy-dialog-form").remove();a(f).dialog({modal:true,title:'<div class="widget-header widget-header-small">                     <h4><i class="glyphicon glyphicon-warning-sign"></i>                     '+Translator.translate("Copy document")+"</h4></div>",buttons:e})},initTranslator:function(){var d=1,e='<tr>                 <td>                     <div>                         <input type="text" class="form-control" name="destination[#{id}]" size="73">                     </div>                 </td>                 <td>                     <div>                         <select class="form-control" name="locale[#{id}]">';a.each(this.getOption("locale"),function(f,g){e+='<option value="'+f+'">'+g+"</option>"});e+='</select>                     </div>                 </td>                 <td>                     <span class="btn btn-default add-translate">                         <i class="glyphicon glyphicon-plus"></i>&nbsp;                         '+Translator.translate("Add")+"                     </span>                 </td>             </tr>";c.on("click",".add-translate",function(){var g=new Template(e),f=a("#table-trad");f.find(".add-translate").removeClass("add-translate").addClass("delete-translate").html('<i class="glyphicon glyphicon-minus"></i> '+Translator.translate("Delete"));f.children("tbody").append(g.evaluate({id:d}));d++});c.on("click",".delete-translate",function(){a(this).parent().parent("tr").remove()})},initTranslationList:function(){a("#table-translation-edit > tbody > tr").on("click",function(f){if(a.inArray(f.target.type,["text","select-one"])!==-1){return false}a(this).find("div").toggleClass("hide");var g=a(f.target).parent().find("input:first");g.focus();var d=g.val();g.val("");g.val(d);a(this).find("td").each(function(){var e=a(this).find("div:last");e.prev("div").html(e.children().val())})})},notification:function(){a(document).on("click",".notification .close",function(){a(this).parent().fadeOut(function(){a(this).remove()});return false});setTimeout(function(){a(".notification").remove()},6000)},initCodeMirror:function(d){this.initUploadLink();CodeMirror.fromTextArea(document.getElementById(d),{lineNumbers:true,matchBrackets:true,mode:"application/x-httpd-php",indentUnit:4,indentWithTabs:true,enterMode:"keep",tabMode:"spaces"})},initUploadLink:function(){var e={},f="These items will be permanently updated and cannot be recovered. Are you sure?",d='<div id="dialog" title="">                     <p>'+Translator.translate(f)+"</p>                 </div>";e[Translator.translate("Confirm")]={text:Translator.translate("Confirm"),"class":"btn btn-danger btn-mini",click:function(){document.location.href=a(".btn-info.update-content").prop("href");a(this).dialog("close")}};e[Translator.translate("Cancel")]={text:Translator.translate("Cancel"),"class":"btn btn-warning",click:function(){a(this).dialog("close");return false}};a("#upload-link").on("click",function(){a("#form-content").toggleClass("hide");return false})},initElFinder:function(e,d){a("#elfinder").elfinder({lang:d,url:e}).elfinder("instance")},initDashBoard:function(e,d){var g=this,f,i,h;f=a(".widget-column").sortable({connectWith:".widget-column",placeholder:"sortable-placeholder",helper:"clone",handle:".widget-header",tolerance:"pointer",opacity:0.4,distance:10,forcePlaceholderSize:true,start:function(){h=0},receive:function(){a(".widget-column").sortable("refresh")},update:function(l,m){var k=a(this).sortable("toArray").join(),j=false;if(g.isEmpty(e[a(this).attr("id")])){i=false}else{a.each(e,function(o,n){if(!g.isEmpty(e[o])&&a.inArray(m.item.attr("id"),n.split(","))!==-1){j=true}});if(j===false){i=true}else{i=e[a(this).attr("id")].length===k.length}}e[a(this).attr("id")]=k;h++;if(h===2||i){a.ajax({url:d,type:"post",dataType:"json",data:e})}}});if(!this.isEmpty(e)){a.each(e,function(j,k){a(k.split(",")).each(function(l,m){a("#"+m).appendTo(a("#"+j))})})}a(".dashboard-close").on("click",function(){a.ajax({url:d,type:"post",dataType:"json",data:{dashboard:true}});a("#dashboard").remove();return false})},initTableList:function(){var d=this;a(".clickable > tbody").find("td").on("click",function(f){if(f.target.tagName!=="IMG"&&f.target.tagName!=="A"){a(this).parent().find(".edit-line")[0].click()}});a(".delete-line").on("click",function(){d.showDeleteDialog(a(this).attr("href"),a(this).parent().parent());return false})},saveCommand:function(){c.on("keydown",function(d){if((d.which===83&&d.ctrlKey)===false&&d.which!==19){return true}d.preventDefault();a("#input-save").click()})},installModule:function(){a("#modules").find("div").hide();a("#module").on("change",function(){a("#modules").find("div").hide();a("#"+a(this).val()).show()})},initUpdate:function(d){a("#update-form").on("submit",function(){if(!confirm(d)){return false}})},initRoles:function(){a("#role-list").find("h3,h2").on("click",function(){a(this).closest("dt").nextUntil("dt").find('input[type="checkbox"]').prop("checked",true)})},checkDataChanged:function(){var d=a("form.relative"),e=d.serialize();c.on("click","#input-save",function(){a(this).closest("form").data("formBeingSaved",true)});b.on("beforeunload",function(){if(a("#input-save").closest("form").data("formBeingSaved")!==true){if(d.serialize()!==e){return true}}})},keepAlive:function(d){setInterval(function(){a.get(d)},60*1000)}}})(jQuery);